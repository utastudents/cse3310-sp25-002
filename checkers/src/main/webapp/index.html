<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Page</title>
  <link rel="icon" type="image/png" href="login/Tokens.png">
  <link rel="stylesheet" href="login/style.css">
  <link rel="stylesheet" href="joingame/styles.css">
  <link rel="stylesheet" href="summary/summary.css">
</head>

<body>

  <div id="new_account">

    <!-- Container of the login page -->
    <div class="login_container">

      <div class="login_left-panel">
        <article class="login_mascot">
          <div class="login_Piece">
            <div class="login_Face">
            </div>
          </div>
        </article>
        <h1>
          <span class="title-top">CHECKERS WITH</span><br>
          <span class="title-bottom">CSE 3310-002</span>
        </h1>
      </div>

      <div class="login_right-panel">
        <form onsubmit="joinGame(); return false;">
      </div>

      <div class="login_input-box">
        <input type="text" placeholder="Enter Username" id="username"
          pattern="(?=.*\d)(?=.*[A-Za-z])(?=.*[!@#$%^&*]).{8,}" required />
      </div>

      <div id="login_message">
        <h3>Username must contain:</h3>
        <p id="letter" class="invalid">A <b>Letter</b></p>
        <p id="num" class="invalid">A <b>Number</b></p>
        <p id="special" class="invalid">A <b>Special Character</b></p>
        <p id="length" class="invalid">Minimum <b>8 characters</b></p>
      </div>

      <div class="login_button-container">
        <button type="submit" class="login_button">Join Game</button>
      </div>
    </form>
    </div>
  </div>
</body>
  
  <div id="game_lobby">

    <header>
      <h1>Game Lobby</h1>
    </header>

    <main>
      <section id="game-options">
        <h2>Choose a Game Mode</h2>
        <div class="button-group">
          <button id="play-vs-player">Play vs Player</button>
          <button id="play-vs-bot">Play vs Bot</button>
          <button id="spectate-bots">Spectate Bot vs Bot</button>
        </div>
      </section>

      <section id="waitlists-section">
        <h2>Current Waitlist</h2>
        <div class="waitlist-container">
        </div>
      </section>

      <section id="notification-section">
        <h2>Notifications</h2>
        <div id="notification">Ready to play!</div>
      </section>
    </main>
  </div>

  <div id="join_game">

    join game
  </div>

  <div id="game_display">
    game display
    <div style="width: 336px; max-width:auto; margin: 10px auto;" class="hidden" id="game_display_container">
      <div style="text-align: center; font-size: 16px; margin-top: 10px; font-weight: bold; color: #333;">
        <p id="current-player">Current Player: Player 1</p>
      </div>

      <br />

      <div class="game"
        style="display: inline-block; border: 4px solid #333; background: #333; margin: 0 auto; box-shadow: 0 4px 12px rgba(0,0,0,0.3); width: 328px; height: 328px; padding: 0; box-sizing: content-box;">
      </div>
      <div style="margin-top: 15px; text-align: center;">
        <button id="resign_buttom" class="button"
          style="background-color: #ff4f4f; color: white; padding: 8px 16px; font-size: 14px; border: none; cursor: pointer; margin: 5px; border-radius: 20px; font-weight: bold; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); transition: all 0.2s ease;">Resign</button>
        <button id="offer_draw_button" class="button"
          style="background-color: #ffcb45; color: #333; padding: 8px 16px; font-size: 14px; border: none; cursor: pointer; margin: 5px; border-radius: 20px; font-weight: bold; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); transition: all 0.2s ease;">Offer
          Draw</button>
      </div>

      <div id="summary">
        
        <button class="back">â—„ Back</button>

        <h1 class="title">LEADERBOARD</h1>

        <div class=" search-container">

        <input class="search" type="text" placeholder="Enter player name" />
        <div>
          <section class="personal">
          <h2>Current Player Stats</h2>
            <div id="playerStats">
            Username: .., Wins: .., Losses: .., Time Played: ..
            </div>
          </section>
          <!-- Pseudocode for java script implementation of player stats intented to be implemented by page manager moved to summary.js -->
        </div>

        <div class="header">
          <p class = "hRank">Rank</p>
          <p class = "hName">Name</p>
          <p class = "hWin">Win</p>
          <p class = "hLoss">Loss</p>
          <p class = "hTime">Time</p>
        </div>

        <!-- Just an example of what it should look like, in practice we can add mode li components when fetching players -->
        <div class="mainLB">
        <ul class="player-list">
          <li>
            <p class = "playerRank">1</p>
            <p class = "playerName">Rank 1</p>
            <p class = "playerWin">10</p>
            <p class = "playerLoss">5</p>
            <p class = "playerTime">2h</p>
          <!--Player 1 - Wins: 10, Losses: 5, Time: 2h--></li>
          <li>
            <p class = "playerRank">1</p>
            <p class = "playerName">fjlajflka</p>
            <p class = "playerWin">10</p>
            <p class = "playerLoss">5</p>
            <p class = "playerTime">2h</p>
          <!--Player 2 - Wins: 8, Losses: 3, Time: 1.5h--></li>
          <li>
            <p class = "playerRank">1</p>
            <p class = "playerName">s</p>
            <p class = "playerWin">10</p>
            <p class = "playerLoss">5</p>
            <p class = "playerTime">2h</p>
          <!--Player 3 - Wins: 15, Losses: 7, Time: 3h--></li>
          <li>
            <p class = "playerRank">1</p>
            <p class = "playerName">sdlkfajwlkfjawel;fa</p>
            <p class = "playerWin">10</p>
            <p class = "playerLoss">5</p>
            <p class = "playerTime">2h</p>
          <!--Player 4 - Wins: 12, Losses: 4, Time: 2.2h--></li>
          <li>
            <p class = "playerRank">1</p>
            <p class = "playerName">test</p>
            <p class = "playerWin">10</p>
            <p class = "playerLoss">5</p>
            <p class = "playerTime">2h</p>
          <!--Player 5 - Wins: 9, Losses: 6, Time: 1.8h--></li>
          </ul>
        </div>

      </div>

      <!-- Note from gamedisplay: Our entire component mostly uses javascript to handle the game display. The only thing we use html for is to create the divs that will be used to display the game. The rest of the functionality is handled by javascript. -->
      <!-- WARNING: Do not remove this javascript file!! This javascript code contains logic for the game display. Imports the CheckersBoard class which contains methods to create and add functionality to the checkers board. -->
      <script src="js/game_display_checkers.js"></script>

</body>

</html>
<script>

  // make only the 'new account'  part visible..

  document.getElementById("new_account").style.display = "initial";
  document.getElementById("game_lobby").style.display = "none";
  document.getElementById("join_game").style.display = "none";
  document.getElementById("game_display").style.display = "none";
  document.getElementById("summary").style.display = "none";



  // a reminder.  we want to create one websocket connection, and use if, basically forever.
  // or until the user decides to go to another page.
  // this requires everything to load from this page.
  var connection = null;

  var clientId = 0;

  var serverUrl;
  serverUrl = "ws://" + window.location.hostname + ":" + (parseInt(location.port) + 100);
  connection = new WebSocket(serverUrl);

  connection.onopen = function (evt) {
    console.log("open");
  }

  connection.onclose = function (evt) {
    console.log("close");
  }

  connection.onmessage = function (evt) {
    var msg;
    msg = evt.data;

    // one websocket for the whole client.
    // everything has to come in right here on this on_message() callback

    console.log("Message received: " + msg);

    // as near as I can tell, there is a desire to send specific processing into specific js files / routines for 
    // processing.  which is great.  but it needs to have some discipline.

    // first, turn the websocket message into a js class for easy processing.
    // if it isn't json formatted, you will get an exception.  maybe a try / catch would be smart?
    let inputData = JSON.parse(msg);
    // depending on what it is, we can then call the other routines for processing
    // (put a test here to determine which object type was received)
    // (the test may get a little more complicated, since field names are not unique.
    //  but, all of the fields in a class should be)
    if ('clientId' in inputData) {
      console.log("recieved a client id of " + inputData.clientId);
      clientId = inputData.clientId; // save this, it will be important.  globally important.
    }
    // this if may need some more knowledge to make it correct.. or maybe one routine needs
    // to deal with instances of this class that are sent....
    else if ('isBot' in inputData && 'game_id' in inputData && 'Message' in inputData) {
      // an example of what is expected if we get here..
      //{"clientID":0,"isBot":false,"game_id":0,"Status":"Success","Message":"Username accepted","gameOver":false,"draw":false}
      receiveFromPageManager(inputData); // notice that an instance of the class is passed as an argument.  perhaps not
      // all of the class has to be sent
    }
    else if (0) {
      // do not like this function, because it wants the connection?
      // why would we leak this out and need to pass this around?

      //game_display_handle_websocket_received_data(connection, data);
    }
    else {
      console.log("msg received, but unknown");
    }





    // previous comment, not sure if it is valid or a misunderstanding.  leaving it here for now.
    // this function handles/receives all the data that is sent to the game dispaly through websockets. Please check `webapp\js\game_display_checkers.js` for more details
    // DO NOT REMOVE OR MODIFY THIS FUNCTION WIHTOUT OUR KNOWLEDGE. IT IS CRUCIAL FOR THE GAME DISPLAY TO WORK PROPERLY.
    //game_display_handle_websocket_received_data(connection, data);

    //Receiving from Page Manager (newAccount)
    //receiveFromPageManager(data);
  }

  // Note from Game Display: comment the line below to hide the game board
  setTimeout(show_game_display(connection, "134242424", "this is player 1", "this is player2", "B"), 3000);

  class UserEvent {
    msg;
  }

  function msg() {
    console.log("button clicked");
    U = new UserEvent();
    U.msg = "i pushed a button";
    connection.send(JSON.stringify(U));
    console.log(JSON.stringify(U))
  }

  document.addEventListener('DOMContentLoaded', () => {
    // Initialize only if the game_lobby element is visible
    if (document.getElementById('game_lobby') && document.getElementById('game_lobby').style.display !== 'none') {
      console.log("Initializing Join Game component...");
      window.joinGameManager = new JoinGameManager();
      window.joinGameManager.initialize();
    }
  });

</script>
<script src="js/loginHandler.js"></script>
<script src="joingame/Data.js"></script>
<script src="joingame/Waitlist.js"></script>
<script src="joingame/Displaynotification.js"></script>
<script src="joingame/Communication.js"></script>
<script src="joingame/MatchMaking.js"></script>
<script src="joingame/JoinGameManager.js"></script>
